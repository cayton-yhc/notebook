# 质因子幂次数与尾零问题（速览）

## 核心概念
- **v_p(x)**：x 中质数 p 的幂次数（p-adic valuation）。  
  例：12=2²×3 ⇒ v₂(12)=2，v₃(12)=1，v₅(12)=0。
- **阶乘 n!**：1×2×…×n。
- **尾零（基数 b）**：b=∏p_i^{e_i}，令 z_i=⌊v_{p_i}(n!)/e_i⌋，尾零数 = min_i z_i。

## 基础公式
- **Legendre / de Polignac 公式**  
  v_p(n!) = ⌊n/p⌋ + ⌊n/p²⌋ + ⌊n/p³⌋ + …（到项为 0 为止）
- **位和公式**  
  v_p(n!) = (n − s_p(n)) / (p − 1)，s_p(n) 为 n 的 p 进制数位和。
- **组合数的 p 幂**  
  v_p( C(n,k) ) = v_p(n!) − v_p(k!) − v_p((n−k)!)。
- **Kummer 定理（判定版）**  
  C(n,k) 被 p 整除 ↔ n 与 k 在 p 进制相加会产生至少一次进位。

## 常见题型与做法
1. **十进制尾零**：min(v₂(n!), v₅(n!))（通常 v₂ 更大，等于 v₅(n!)）。
2. **任意进制尾零**：b=∏p_i^{e_i}，取 min_i ⌊v_{p_i}(n!)/e_i⌋。
3. **区间乘积 ∏_{x=L}^R x 的 p 幂**：v_p(R!) − v_p((L−1)!)。
4. **C(n,k) 的尾零/被 p 整除最高次**：上式套 v_p。
5. **“n! 是否能被 m 整除”**：分解 m=∏p_i^{e_i}，检验 v_{p_i}(n!) ≥ e_i。
6. **“最大 k 使 a^k | n!”**：a=∏p_i^{e_i}，k = min_i ⌊v_{p_i}(n!)/e_i⌋。
7. **最小 n 使 m | n!（反问题）**：对每个 p_i 的 e_i，用二分/增量找最小 n 使 v_{p_i}(n!) ≥ e_i；取各 p_i 的最大要求。
8. **等差乘积 / 双阶乘 n!! / 步长乘积**：逐项累加 v_p 或化为阶乘比（如 Γ 函数/多重阶乘恒等式）。
9. **LCM/GCD 相关**：lcm(1..n) 中 v_p 为 max t 使 p^t ≤ n。

## 伪代码（计算 v_p(n!)）
```c
function vp_fact(n, p):
ans = 0
while n > 0:
n //= p
ans += n
return ans
```
## 复杂度
- 单个 v_p(n!)：O(log_p n)。
- 多质因子：对每个 p 独立计算，取 min / 做加减。

## 小例
- v₅(100!) = ⌊100/5⌋ + ⌊100/25⌋ = 20 + 4 = 24 ⇒ 10 进制尾零为 24。
- C(10,3) 的 2 幂：v₂(10!)−v₂(3!)−v₂(7!) = (5+2+1)−1−4 = 3。

## 常见坑
- 忽略进制分解（非 10 进制时必须按 b=∏p_i^{e_i} 处理）。
- 只数 5 忽略 2（十进制尾零须取 min(v₂, v₅)）。
- 区间乘积未转化为阶乘差。
- 反问题未对每个质因子分别求最小 n 后取最大。
